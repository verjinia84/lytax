<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>세금 계산기</title>
    <!-- html2canvas 라이브러리 추가 -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --background-color: #ecf0f1;
            --text-color: #34495e;
            --input-background: #fff;
            --result-background: #e8f4fd; /* 파스텔톤 하늘색 */
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px; /* 20px에서 10px로 줄임 */
            background-color: var(--background-color);
            color: var(--text-color);
        }
        .calculator-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        .calculator {
            background-color: #fff;
            border-radius: 10px;
            padding: 15px; /* 20px에서 15px로 줄임 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 350px;
            margin-bottom: 15px; /* 20px에서 15px로 줄임 */
        }
        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 15px; /* 30px에서 15px로 줄임 */
            font-size: 24px; /* 제목 크기 줄임 */
        }
        label {
            display: block;
            margin: 10px 0 3px; /* 이전 설정 유지 */
            color: var(--secondary-color);
            font-weight: bold; /* 볼드 스타일 복원 */
        }
        input[type="text"], select {
            display: block;
            width: calc(100% - 20px);
            padding: 10px; /* 9px에서 10px로 증가 */
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            background-color: var(--input-background);
            color: var(--text-color);
            font-size: 14px; /* 13px에서 14px로 증가 */
            margin-bottom: 5px;
        }
        .result {
            margin-top: 15px; /* 20px에서 15px로 줄임 */
            padding: 10px; /* 15px에서 10px로 줄임 */
            background-color: var(--result-background);
            border-radius: 4px;
        }
        .result p {
            margin: 5px 0;
            font-weight: bold;
        }
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px; /* 30px에서 20px로 줄임 */
        }
        button {
            padding: 10px 20px; /* 12px 24px에서 줄임 */
            border: none;
            border-radius: 4px;
            background-color: var(--primary-color);
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            font-size: 14px; /* 16px에서 14px로 줄임 */
            font-weight: bold;
        }
        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        @media (min-width: 768px) {
            .calculator {
                width: calc(50% - 20px);
            }
        }
        @media (min-width: 1024px) {
            .calculator {
                width: calc(25% - 15px); /* 33.33%에서 25%로 변경하여 한 줄에 4개 표시 */
            }
            #addCalculator, #resetAll {
                display: inline-block;
            }
        }
        @media (max-width: 1023px) {
            #addCalculator, #resetAll {
                display: none;
            }
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-top: 15px;
        }
        .checkbox-container input[type="checkbox"] {
            margin-right: 10px;
        }
        #calculatorType {
            margin-bottom: 20px;
            width: 100%;
            max-width: 350px;
        }
        /* 새로운 스타일 추가 */
        .calculator-type-buttons {
            display: flex;
            justify-content: center;
            margin-bottom: 15px; /* 20px에서 15px로 줄임 */
        }

        .calculator-type-button {
            padding: 8px 16px; /* 10px 20px에서 줄임 */
            margin: 0 10px;
            border: none;
            border-radius: 4px;
            background-color: var(--primary-color);
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            font-size: 14px; /* 16px에서 14px로 줄임 */
            font-weight: bold;
        }

        .calculator-type-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .calculator-type-button:active {
            transform: translateY(0);
        }

        .calculator-type-button.active {
            background-color: var(--secondary-color);
        }

        /* 스크린샷 버튼 스타일 추가 */
        #screenshotButton {
            background-color: #27ae60;
            margin-left: 10px;
        }
        #screenshotButton:hover {
            background-color: #2ecc71;
        }
        .delete-button {
            background-color: #e74c3c;
            margin-top: 10px;
        }
        .delete-button:hover {
            background-color: #c0392b;
        }
        .total-tax {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 15px; /* 20px에서 15px로 줄임 */
            padding: 8px; /* 10px에서 8px로 줄임 */
            background-color: var(--result-background);
            border-radius: 4px;
        }
        
        /* 추가: 스크롤바 스타일 */
        body {
            max-height: 100vh;
            overflow-y: auto;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px; /* 8px에서 5px로 줄임 */
        }

        .result-label, .result-value {
            padding: 3px 0;
            font-weight: bold;
            font-size: 14px; /* 13px에서 14px로 증가 */
        }

        .gift-deduction-container {
            display: flex;
            flex-direction: column;
            gap: 5px; /* 10px에서 5px로 줄임 */
        }

        .gift-deduction-container select,
        .gift-deduction-container input {
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 0; /* 하단 여백 제거 */
        }

        /* 직접 입력 칸의 스타일 수정 */
        .giftDeductionCustom {
            width: 100% !important;
            display: block;
            padding: 10px; /* 9px에서 10px로 증가 */
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            background-color: var(--input-background);
            color: var(--text-color);
            font-size: 14px; /* 13px에서 14px로 증가 */
            margin-top: 5px;
        }

        /* 전체적으로 위로 올리기 */
        .calculator-container {
            margin-top: -5px; /* -10px에서 -5px로 조정 */
        }

        /* 스크롤바 스타일 */
        body {
            scrollbar-width: thin;
            scrollbar-color: var(--secondary-color) var(--background-color);
        }

        body::-webkit-scrollbar {
            width: 8px;
        }

        body::-webkit-scrollbar-track {
            background: var(--background-color);
        }

        body::-webkit-scrollbar-thumb {
            background-color: var(--secondary-color);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>세금 계산기</h1>
    <div class="calculator-type-buttons">
        <button id="incomeButton" class="calculator-type-button active">2024년 종합소득세 계산기</button>
        <button id="giftButton" class="calculator-type-button">증여세 계산기</button>
        <button id="screenshotButton" class="calculator-type-button">스크린샷</button>
    </div>
    <div class="calculator-container" id="calculatorContainer"></div>
    <div class="total-tax" id="totalTax"></div>
    <div class="buttons">
        <button id="addCalculator">계산기 추가</button>
        <button id="resetAll">모두 초기화</button>
    </div>

    <script>
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function unformatNumber(str) {
            return parseFloat(str.replace(/,/g, '')) || 0;
        }

        function createIncomeCalculator() {
            const calculator = document.createElement('div');
            calculator.className = 'calculator';
            calculator.innerHTML = `
                <h2 contenteditable="true">2024년 종합소득세 계산</h2>
                <label for="monthlyIncome">월 소득 (원):</label>
                <input type="text" class="monthlyIncome" placeholder="월 소득을 입력하세요">
                <label for="monthMultiplier">곱할 개월 수:</label>
                <input type="text" class="monthMultiplier" value="12">
                <label for="businessIncome">사업소득 (원):</label>
                <input type="text" class="businessIncome" placeholder="금액을 입력하세요">
                <label for="incomeDeduction">득공제 (원):</label>
                <input type="text" class="incomeDeduction" value="1,500,000">
                <div class="result">
                    <div class="result-row">
                        <span class="result-label">과세표준:</span>
                        <span class="result-value"><span class="taxableIncome">0</span> 원</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">산출세액:</span>
                        <span class="result-value"><span class="calculatedTax">0</span> 원</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">한계세율:</span>
                        <span class="result-value"><span class="marginalTaxRate">0</span> %</span>
                    </div>
                </div>
                <label for="taxCreditReduction">세액공제 (원):</label>
                <input type="text" class="taxCreditReduction" value="70,000">
                <div class="result">
                    <div class="result-row">
                        <span class="result-label">최종 납부세액:</span>
                        <span class="result-value"><span class="finalTax">0</span> 원</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">최저한세:</span>
                        <span class="result-value"><span class="minimumTax">0</span> 원</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">추가 필요 세액공제:</span>
                        <span class="result-value"><span class="additionalTaxCredit">0</span> 원</span>
                    </div>
                </div>
            `;

            calculator.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', function() {
                    updateInputFormat(this);
                    if (this.classList.contains('monthlyIncome') || this.classList.contains('monthMultiplier')) {
                        calculateYearlyIncome(calculator);
                    }
                    calculateIncomeTax(calculator);
                });
            });

            return calculator;
        }

        function createGiftCalculator() {
            const calculator = document.createElement('div');
            calculator.className = 'calculator';
            calculator.innerHTML = `
                <h2 contenteditable="true">증여세 계산</h2>
                <label for="giftAmount">증여재산가액 (원):</label>
                <input type="text" class="giftAmount" placeholder="증여재산가액을 입력하세요">
                <label for="previousGift">사전증여재산 (원):</label>
                <input type="text" class="previousGift" placeholder="사전증여재산을 입력하세요">
                <label for="giftDeduction">증여재산공제 (원):</label>
                <div class="gift-deduction-container">
                    <select class="giftDeduction">
                        <option value="10000000">10,000,000</option>
                        <option value="20000000">20,000,000</option>  <!-- 새로운 옵션 추가 -->
                        <option value="50000000">50,000,000</option>
                        <option value="600000000">600,000,000</option>
                    </select>
                    <input type="text" class="giftDeductionCustom" placeholder="직접 입력">
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="generationSkipping_${Date.now()}" class="generationSkipping">
                    <label for="generationSkipping_${Date.now()}">세대할증</label>
                </div>
                <div class="result">
                    <div class="result-row">
                        <span class="result-label">증여세 과세표준:</span>
                        <span class="result-value"><span class="taxableGift">0</span> 원</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">산출세액:</span>
                        <span class="result-value"><span class="calculatedTax">0</span> 원</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">한계세율:</span>
                        <span class="result-value"><span class="marginalTaxRate">0</span> %</span>
                    </div>
                </div>
                <div class="result">
                    <div class="result-row">
                        <span class="result-label">신고세액공제:</span>
                        <span class="result-value"><span class="taxCreditReduction">0</span> 원</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">최종 납부세액:</span>
                        <span class="result-value"><span class="finalTax">0</span> 원</span>
                    </div>
                </div>
                <button class="delete-button">삭제</button>
            `;

            calculator.querySelectorAll('input, select').forEach(input => {
                input.addEventListener('input', function() {
                    if (this.type === 'text') {
                        updateInputFormat(this);
                    }
                    calculateGiftTax(calculator);
                });
            });

            const generationSkippingCheckbox = calculator.querySelector('.generationSkipping');
            generationSkippingCheckbox.addEventListener('change', function() {
                calculateGiftTax(calculator);
            });

            // 라벨 클릭 이벤트 추가
            const generationSkippingLabel = calculator.querySelector('label[for^="generationSkipping_"]');
            generationSkippingLabel.addEventListener('click', function() {
                setTimeout(() => calculateGiftTax(calculator), 0);
            });

            calculator.querySelector('.delete-button').addEventListener('click', function() {
                calculator.remove();
                updateTotalTax();
            });

            return calculator;
        }

        function updateInputFormat(input) {
            let value = unformatNumber(input.value);
            input.value = formatNumber(value);
        }

        function calculateYearlyIncome(calculator) {
            const monthlyIncome = unformatNumber(calculator.querySelector('.monthlyIncome').value);
            const monthMultiplier = unformatNumber(calculator.querySelector('.monthMultiplier').value);
            const yearlyIncome = monthlyIncome * monthMultiplier;
            calculator.querySelector('.businessIncome').value = formatNumber(yearlyIncome);
        }

        function calculateIncomeTax(calculator) {
            const businessIncome = unformatNumber(calculator.querySelector('.businessIncome').value);
            const incomeDeduction = unformatNumber(calculator.querySelector('.incomeDeduction').value);
            const taxCreditReduction = unformatNumber(calculator.querySelector('.taxCreditReduction').value);
            
            const taxableIncome = Math.max(0, businessIncome - incomeDeduction);
            calculator.querySelector('.taxableIncome').innerText = formatNumber(taxableIncome);
            
            let calculatedTax = 0;
            if (taxableIncome <= 14000000) {
                calculatedTax = taxableIncome * 0.06;
            } else if (taxableIncome <= 50000000) {
                calculatedTax = 14000000 * 0.06 + (taxableIncome - 14000000) * 0.15;
            } else if (taxableIncome <= 88000000) {
                calculatedTax = 14000000 * 0.06 + 36000000 * 0.15 + (taxableIncome - 50000000) * 0.24;
            } else if (taxableIncome <= 150000000) {
                calculatedTax = 14000000 * 0.06 + 36000000 * 0.15 + 38000000 * 0.24 + (taxableIncome - 88000000) * 0.35;
            } else if (taxableIncome <= 300000000) {
                calculatedTax = 14000000 * 0.06 + 36000000 * 0.15 + 38000000 * 0.24 + 62000000 * 0.35 + (taxableIncome - 150000000) * 0.38;
            } else if (taxableIncome <= 500000000) {
                calculatedTax = 14000000 * 0.06 + 36000000 * 0.15 + 38000000 * 0.24 + 62000000 * 0.35 + 150000000 * 0.38 + (taxableIncome - 300000000) * 0.40;
            } else if (taxableIncome <= 1000000000) {
                calculatedTax = 14000000 * 0.06 + 36000000 * 0.15 + 38000000 * 0.24 + 62000000 * 0.35 + 150000000 * 0.38 + 200000000 * 0.40 + (taxableIncome - 500000000) * 0.42;
            } else {
                calculatedTax = 14000000 * 0.06 + 36000000 * 0.15 + 38000000 * 0.24 + 62000000 * 0.35 + 150000000 * 0.38 + 200000000 * 0.40 + 500000000 * 0.42 + (taxableIncome - 1000000000) * 0.45;
            }
            calculator.querySelector('.calculatedTax').innerText = formatNumber(Math.round(calculatedTax));
            
            const finalTax = Math.max(0, calculatedTax - taxCreditReduction);
            calculator.querySelector('.finalTax').innerText = formatNumber(Math.round(finalTax));

            // 최저한세 계산
            let minimumTax = 0;
            if (calculatedTax <= 30000000) {
                minimumTax = calculatedTax * 0.35;
            } else {
                minimumTax = 30000000 * 0.35 + (calculatedTax - 30000000) * 0.45;
            }
            calculator.querySelector('.minimumTax').innerText = formatNumber(Math.round(minimumTax));

            // 추가 필요 세액공제 계산
            const additionalTaxCredit = Math.max(0, finalTax - minimumTax);
            calculator.querySelector('.additionalTaxCredit').innerText = formatNumber(Math.round(additionalTaxCredit));

            let marginalTaxRate = 0;
            if (taxableIncome <= 14000000) {
                marginalTaxRate = 6;
            } else if (taxableIncome <= 50000000) {
                marginalTaxRate = 15;
            } else if (taxableIncome <= 88000000) {
                marginalTaxRate = 24;
            } else if (taxableIncome <= 150000000) {
                marginalTaxRate = 35;
            } else if (taxableIncome <= 300000000) {
                marginalTaxRate = 38;
            } else if (taxableIncome <= 500000000) {
                marginalTaxRate = 40;
            } else if (taxableIncome <= 1000000000) {
                marginalTaxRate = 42;
            } else {
                marginalTaxRate = 45;
            }
            calculator.querySelector('.marginalTaxRate').innerText = marginalTaxRate;
        }

        function calculateGiftTax(calculator) {
            const giftAmount = unformatNumber(calculator.querySelector('.giftAmount').value);
            const previousGift = unformatNumber(calculator.querySelector('.previousGift').value);
            let giftDeduction = unformatNumber(calculator.querySelector('.giftDeduction').value);
            const customDeduction = unformatNumber(calculator.querySelector('.giftDeductionCustom').value);
            const isGenerationSkipping = calculator.querySelector('.generationSkipping').checked;
            
            if (customDeduction > 0) {
                giftDeduction = customDeduction;
            }
            
            const taxableGift = Math.max(0, giftAmount + previousGift - giftDeduction);
            calculator.querySelector('.taxableGift').innerText = formatNumber(taxableGift);
            
            let calculatedTax = 0;
            if (taxableGift <= 100000000) {
                calculatedTax = taxableGift * 0.10;
            } else if (taxableGift <= 500000000) {
                calculatedTax = 10000000 + (taxableGift - 100000000) * 0.20;
            } else if (taxableGift <= 1000000000) {
                calculatedTax = 90000000 + (taxableGift - 500000000) * 0.30;
            } else if (taxableGift <= 3000000000) {
                calculatedTax = 240000000 + (taxableGift - 1000000000) * 0.40;
            } else {
                calculatedTax = 1040000000 + (taxableGift - 3000000000) * 0.50;
            }

            if (isGenerationSkipping) {
                calculatedTax *= 1.3; // 세대할증 30% 적용
            }

            calculator.querySelector('.calculatedTax').innerText = formatNumber(Math.round(calculatedTax));

            const taxCreditReduction = calculatedTax * 0.03;
            calculator.querySelector('.taxCreditReduction').innerText = formatNumber(Math.round(taxCreditReduction));

            const finalTax = Math.max(0, calculatedTax - taxCreditReduction);
            calculator.querySelector('.finalTax').innerText = formatNumber(Math.round(finalTax));

            let marginalTaxRate = 0;
            if (taxableGift <= 100000000) {
                marginalTaxRate = 10;
            } else if (taxableGift <= 500000000) {
                marginalTaxRate = 20;
            } else if (taxableGift <= 1000000000) {
                marginalTaxRate = 30;
            } else if (taxableGift <= 3000000000) {
                marginalTaxRate = 40;
            } else {
                marginalTaxRate = 50;
            }

            if (isGenerationSkipping) {
                marginalTaxRate = Math.min(marginalTaxRate * 1.3, 50); // 세대할증 30% 적용, 최대 50%
            }

            calculator.querySelector('.marginalTaxRate').innerText = marginalTaxRate;

            // 총 부담세액 업데이트
            updateTotalTax();
        }

        function updateTotalTax() {
            const calculators = document.querySelectorAll('.calculator');
            let totalTax = 0;
            calculators.forEach(calc => {
                const finalTaxElement = calc.querySelector('.finalTax');
                if (finalTaxElement) {
                    totalTax += unformatNumber(finalTaxElement.innerText);
                }
            });
            document.getElementById('totalTax').innerText = `총 부담세액: ${formatNumber(Math.round(totalTax))} 원`;
        }

        function switchCalculatorType(type) {
            const incomeButton = document.getElementById('incomeButton');
            const giftButton = document.getElementById('giftButton');
            const container = document.getElementById('calculatorContainer');

            if (type === 'income') {
                incomeButton.classList.add('active');
                giftButton.classList.remove('active');
            } else {
                incomeButton.classList.remove('active');
                giftButton.classList.add('active');
            }

            container.innerHTML = '';
            if (type === 'income') {
                container.appendChild(createIncomeCalculator());
            } else {
                container.appendChild(createGiftCalculator());
            }

            if (type === 'gift') {
                document.getElementById('totalTax').style.display = 'block';
            } else {
                document.getElementById('totalTax').style.display = 'none';
            }
            updateTotalTax();
        }

        function addCalculator() {
            const container = document.getElementById('calculatorContainer');
            const activeButton = document.querySelector('.calculator-type-button.active');
            const calculatorType = activeButton.id === 'incomeButton' ? 'income' : 'gift';
            
            if (calculatorType === 'income') {
                container.appendChild(createIncomeCalculator());
            } else {
                container.appendChild(createGiftCalculator());
                updateTotalTax();
            }
        }

        function resetAll() {
            const activeButton = document.querySelector('.calculator-type-button.active');
            const calculatorType = activeButton.id === 'incomeButton' ? 'income' : 'gift';
            switchCalculatorType(calculatorType);
        }

        // 스크린샷 기능 수정
        function takeScreenshot() {
            const container = document.getElementById('calculatorContainer');
            const totalTaxElement = document.getElementById('totalTax');
            
            // 현재 스크롤 위치 저장
            const scrollPos = window.pageYOffset;

            // 임시 컨테이너 생성
            const tempContainer = document.createElement('div');
            tempContainer.style.cssText = `
                position: absolute;
                left: -9999px;
                width: ${container.offsetWidth}px;
                background-color: ${getComputedStyle(document.body).backgroundColor};
                padding: 20px;
                box-sizing: border-box;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                color: ${getComputedStyle(document.body).color};
            `;

            // 계산기 컨테이너와 총 부담세액 요소를 임시 컨테이너에 복사
            tempContainer.innerHTML = container.outerHTML + totalTaxElement.outerHTML;

            // 스타일 복사 및 입력 필드 텍스트 정렬 스타일 추가
            const styles = document.getElementsByTagName('style');
            for (let i = 0; i < styles.length; i++) {
                tempContainer.insertAdjacentHTML('afterbegin', styles[i].outerHTML);
            }
            const alignStyle = document.createElement('style');
            alignStyle.textContent = `
                input[type="text"], select {
                    padding-top: 5px !important;
                    padding-bottom: 15px !important;
                    line-height: 1.2 !important;
                    transform: translateY(3px) !important;
                }
            `;
            tempContainer.insertAdjacentElement('afterbegin', alignStyle);

            // 임시 컨테이너를 body에 추가
            document.body.appendChild(tempContainer);

            // 임시 컨테이너 내의 모든 입력 필드와 선택 요소 값을 업데이트
            tempContainer.querySelectorAll('input, select').forEach((element, index) => {
                const originalElement = container.querySelectorAll('input, select')[index];
                if (element.tagName === 'SELECT') {
                    element.value = originalElement.value;
                } else {
                    element.value = originalElement.value;
                }
            });

            // 임시 컨테이너 내의 계산 결과를 업데이트
            tempContainer.querySelectorAll('.calculator').forEach((calc, index) => {
                const originalCalc = container.querySelectorAll('.calculator')[index];
                calc.querySelectorAll('.result-value span, .result span').forEach((span, i) => {
                    const originalSpan = originalCalc.querySelectorAll('.result-value span, .result span')[i];
                    span.innerText = originalSpan.innerText;
                });
            });

            // 체크박스 상태 업데이트
            tempContainer.querySelectorAll('input[type="checkbox"]').forEach((checkbox, index) => {
                const originalCheckbox = container.querySelectorAll('input[type="checkbox"]')[index];
                checkbox.checked = originalCheckbox.checked;
            });

            // 폰트 로딩을 위한 지연
            setTimeout(() => {
                html2canvas(tempContainer, {
                    allowTaint: true,
                    useCORS: true,
                    height: tempContainer.scrollHeight,
                    windowHeight: tempContainer.scrollHeight,
                    scale: 2 // 해상도 증가
                }).then(function(canvas) {
                    // 임시 컨테이너 제거
                    document.body.removeChild(tempContainer);

                    // 원래 스크롤 위치로 복원
                    window.scrollTo(0, scrollPos);

                    // 캔버스를 이미지로 변환하여 다운로드
                    var link = document.createElement('a');
                    link.download = '세금계산기_스크린샷.png';
                    link.href = canvas.toDataURL();
                    link.click();
                });
            }, 500); // 0.5초 지연
        }

        document.getElementById('incomeButton').addEventListener('click', () => switchCalculatorType('income'));
        document.getElementById('giftButton').addEventListener('click', () => switchCalculatorType('gift'));
        document.getElementById('addCalculator').addEventListener('click', addCalculator);
        document.getElementById('resetAll').addEventListener('click', resetAll);
        document.getElementById('screenshotButton').addEventListener('click', takeScreenshot);

        // 초기 계산기 추가
        switchCalculatorType('income');
    </script>
</body>
</html>
